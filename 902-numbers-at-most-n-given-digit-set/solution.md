# 最大为 N 的数字组合

&emsp;&emsp;[源码](./solution.c)

&emsp;&emsp;设可选数字集合 $M = \lbrace 1, 3, 5, 7 \rbrace$ , 其元素个数 $m = 4$.

&emsp;&emsp;设上界 $n = 14534$ , $n$ 的位数 $k = 4$.

&emsp;&emsp;对每个数字 $n$ 而言, 它的答案首先要包括它的后 $k-1$ 位使用 $M$ 的任意组合, 即上界为 $9999$ 的答案.

&emsp;&emsp;我们可以把这个答案分成 $[0, 9]$, $[10, 99]$, $[100, 999]$, $[1000, 9999]$ 四个区间, 分别对应 $1, 2, ..., k$ 位数的情况.

&emsp;&emsp;不妨把每个区间的答案记作 $free[i]$, 其含义为使用集合 $M$ 表示 $i + 1$ 位数的情况总数. 不难得出 $free[i] = m ^ {i + 1}$.

&emsp;&emsp;要得到最终答案的话, 除了这 $4$ 个区间之外还需要 $[10000, 14535]$ 这个区间的情况数. 上面考虑的四个区间是无限制的组合, 下面定义一种有限制的组合.

&emsp;&emsp;设 $leq[i]$ 为 $i + 1$ 位受限区间的情况总数, 区间下界为最小的 $i + 1$ 位数, 上界为 $n$ 的后 $i + 1$ 位. 即 $leq[0]$ 代表区间 $[1, 4]$ 的情况总数, $leq[1]$ 代表区间 $[10, 34]$ 的情况总数, $leq[3]$ 代表区间 $[100, 534]$ 的情况总数, 以此类推.

&emsp;&emsp;显然, 欲从 $leq[i]$ 推出 $leq[i + 1]$, 只需知道 $M$ 中小于 $n$ 的第 $i$ 位数的元素个数 $lt[n_i]$, 以及 $M$ 中是否包含 $n$ 的第 $i$ 位数 $eq[n_i]$. 递推方程为:
$$leq[i] = lt[n_i] * free[i - 1] + eq[n_i] * leq[i - 1]$$

&emsp;&emsp;首先求出 $M$ 中比 $[1, 9]$ 中每个整数小的元素个数, 以及 $M$ 中都有哪些元素.

|$i$    |$1$|$2$|$3$|$4$|$5$|$6$|$7$|$8$|$9$|
|:-----:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$lt[i]$|$0$|$1$|$1$|$2$|$2$|$3$|$3$|$4$|$4$|
|$eq[i]$|$1$|$0$|$1$|$0$|$1$|$0$|$1$|$0$|$0$|

&emsp;&emsp;再根据上表做递推.

|$DIGIT_{index}$|$1_4$|$4_3$|$5_2$|$3_1$|$4_0$|
|:-------------:|:---:|:---:|:---:|:---:|:---:|
|$lt[DIGIT]$    |$0$  |$2$  |$2$  |$1$  |$2$  |
|$eq[DIGIT]$    |$1$  |$0$  |$1$  |$1$  |$0$  |
|$free[index]$|$/$|$\underline{256}$|$\underline{64}$|$\underline{16}$|$\underline{4}$|
|$leq[index]$|$\underline{128}$|$128$|$38$|$6$|$2$|

&emsp;&emsp;所求结果, 即区间 $[0, 14534]$ 的情况数为区间 $[0, 9]$, $[10, 99]$, $[100, 999]$, $[1000, 9999]$, $[10000, 14534]$ 的情况数之和, 即:
$$res = leq[k] + \sum_{i=0}^{k - 1}free[i]$$
&emsp;&emsp;也就是上表中带下划线的元素之和.
